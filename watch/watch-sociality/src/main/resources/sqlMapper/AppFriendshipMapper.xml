<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.chinamcom.framework.sociality.dao.AppFriendshipMapper" >
  <resultMap id="BaseResultMap" type="com.chinamcom.framework.sociality.model.AppFriendship" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="ID" property="id" jdbcType="INTEGER" />
    <result column="UID_0" property="uid0" jdbcType="INTEGER" />
    <result column="UID_1" property="uid1" jdbcType="INTEGER" />
    <result column="STATUS" property="status" jdbcType="INTEGER" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="ALIAS_0" property="alias0" jdbcType="VARCHAR" />
    <result column="ALIAS_1" property="alias1" jdbcType="VARCHAR" />
    <result column="watchstat" property="watchstat" jdbcType="INTEGER" />
    <result column="wasdeletedfriend" property="wasdeletedfriend" jdbcType="INTEGER" />
  </resultMap>
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    ID, UID_0, UID_1, STATUS, CREATE_TIME, UPDATE_TIME, ALIAS_0, ALIAS_1, watchstat, wasdeletedfriend 
  </sql>
  <select id="selectByExample" resultMap="BaseResultMap" parameterType="com.chinamcom.framework.sociality.model.AppFriendshipExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from app_friendship
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  
  <select id="selectIsFriend" resultMap="BaseResultMap" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->  <!-- au.head, au.name username,-->
    SELECT
	 au.uid uid_0,au.alias aliasname,t.status,t.alias_0,aui.nickname,aui.sex,aui.headImage,aui.phonenum,t.watchstat FROM 
		`app_user` AS au 
		LEFT JOIN
		(
			SELECT * FROM `app_friendship` WHERE uid_0=
				#{record.uid,jdbcType=INTEGER} AND (STATUS in 
		<foreach item="item" index="index" collection="record.status" open="(" separator="," close=")">  
  		#{item}  
 	</foreach>  or wasdeletedfriend = #{record.wasdeletedfriend,jdbcType=INTEGER})
		)t ON au.uid=t.uid_1 
		LEFT JOIN `app_userinfo` AS  aui
		ON au.uid=aui.uid
	 WHERE au.uid  IN(
			SELECT uid_1 FROM `app_friendship` WHERE uid_0=#{record.uid,jdbcType=INTEGER} AND (STATUS in <foreach item="item" index="index" collection="record.status" open="(" separator="," close=")">  
  		#{item}  
 	</foreach>  or wasdeletedfriend = #{record.wasdeletedfriend,jdbcType=INTEGER} ))
	<if test="record.gid != null">
			AND t.uid_1 NOT IN(SELECT uid FROM `app_group_user` WHERE gid=#{record.gid,jdbcType=INTEGER} AND STATUS=1)
	</if>
	<if test="record.nickname!=null">  <!--   #{record.nickname,jdbcType=VARCHAR} -->
	    and (
	    aui.nickname like CONCAT('%',#{record.nickname},'%')
	    or aui.phonenum like CONCAT('%',#{record.nickname},'%')
	    or t.ALIAS_0 like CONCAT('%',#{record.nickname},'%')
	    )
	   
	</if>
	<!--  AND aui.phonenum is not null -->
  </select>
  <!-- 新增作为被申请人的好友记录start -->
		<select id="selectIsFriendPassive" resultMap="BaseResultMap" parameterType="map" >

    SELECT
	 au.uid uid_0,au.alias aliasname,t.status,t.alias_0,aui.nickname,aui.sex,aui.headImage,aui.phonenum FROM 
		`app_user` AS au 
		LEFT JOIN
		(
			SELECT * FROM `app_friendship` WHERE uid_1=
				#{record.uid,jdbcType=INTEGER} AND STATUS =#{record.status}
		)t ON au.uid=t.uid_0 
		LEFT JOIN `app_userinfo` AS  aui
		ON au.uid=aui.uid
	 WHERE au.uid  IN(
			SELECT uid_0 FROM `app_friendship` WHERE uid_1=#{record.uid,jdbcType=INTEGER} AND STATUS =#{record.status})
	<if test="record.gid != null">
			AND t.uid_1 NOT IN(SELECT uid FROM `app_group_user` WHERE gid=#{record.gid,jdbcType=INTEGER} AND STATUS=1)
	</if>
	</select>
   <!-- 新增作为被申请人的好友记录start -->
   
  <select id="selectNewFriend" resultMap="BaseResultMap" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <if test="record.imei != null" ><!-- au.head, au.name username, -->
	 SELECT
	   au.uid uid_0,au.alias aliasname,t.status,t.alias_0,aui.nickname,aui.sex,
	   aui.headImage,aui.phonenum,
	   CASE t.watchstat WHEN NULL THEN 1 WHEN 0 THEN 1 END AS watchstat   
	    FROM 
		`app_user` AS au LEFT JOIN
		(
			SELECT * FROM `app_friendship` WHERE uid_0=
				#{record.uid,jdbcType=INTEGER} 
			AND uid_1 IN(
			SELECT au.uid FROM `app_user` AS au WHERE imei=#{record.imei,jdbcType=VARCHAR})
		)t ON au.uid=t.uid_1 
		LEFT JOIN `app_userinfo` AS  aui
		ON au.uid=aui.uid
	 WHERE au.imei=#{record.imei,jdbcType=VARCHAR} 
    </if>
     <if test="record.imei == null" >
      SELECT imei FROM `app_user` WHERE uid=#{record.uid,jdbcType=INTEGER} 
     </if>
	 

  </select>
  
  <select id="selectByExampleNewApply" resultMap="BaseResultMap" parameterType="com.chinamcom.framework.sociality.model.AppFriendshipExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>   <!--,au.head,au.name username  -->
    ap1.*,au.nickname aliasname,au.headImage headImage FROM 
	(SELECT * FROM `app_friendship`  
		<if test="_parameter != null" >
      		<include refid="Example_Where_Clause" />
    	</if>
	 ) ap1 
	LEFT JOIN `app_userinfo` AS au
	ON au.uid=ap1.uid_0
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from app_friendship
    where ID = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from app_friendship
    where ID = #{id,jdbcType=INTEGER}
  </delete>
  <delete id="deleteByExample" parameterType="com.chinamcom.framework.sociality.model.AppFriendshipExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from app_friendship
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="com.chinamcom.framework.sociality.model.AppFriendship" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into app_friendship (ID, UID_0, UID_1, 
      STATUS, CREATE_TIME, UPDATE_TIME, 
      ALIAS_0, ALIAS_1)
    values (#{id,jdbcType=INTEGER}, #{uid0,jdbcType=INTEGER}, #{uid1,jdbcType=INTEGER}, 
      #{status,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, 
      #{alias0,jdbcType=VARCHAR}, #{alias1,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="com.chinamcom.framework.sociality.model.AppFriendship" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into app_friendship
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        ID,
      </if>
      <if test="uid0 != null" >
        UID_0,
      </if>
      <if test="uid1 != null" >
        UID_1,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="createTime != null" >
        CREATE_TIME,
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME,
      </if>
      <if test="alias0 != null" >
        ALIAS_0,
      </if>
      <if test="alias1 != null" >
        ALIAS_1,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=INTEGER},
      </if>
      <if test="uid0 != null" >
        #{uid0,jdbcType=INTEGER},
      </if>
      <if test="uid1 != null" >
        #{uid1,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="alias0 != null" >
        #{alias0,jdbcType=VARCHAR},
      </if>
      <if test="alias1 != null" >
        #{alias1,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="com.chinamcom.framework.sociality.model.AppFriendshipExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(*) from app_friendship
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update app_friendship
    <set >
      <if test="record.id != null" >
        ID = #{record.id,jdbcType=INTEGER},
      </if>
      <if test="record.uid0 != null" >
        UID_0 = #{record.uid0,jdbcType=INTEGER},
      </if>
      <if test="record.uid1 != null" >
        UID_1 = #{record.uid1,jdbcType=INTEGER},
      </if>
      <if test="record.status != null" >
        STATUS = #{record.status,jdbcType=INTEGER},
      </if>
      <if test="record.createTime != null" >
        CREATE_TIME = #{record.createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.updateTime != null" >
        UPDATE_TIME = #{record.updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="record.alias0 != null" >
        ALIAS_0 = #{record.alias0,jdbcType=VARCHAR},
      </if>
      <if test="record.alias1 != null" >
        ALIAS_1 = #{record.alias1,jdbcType=VARCHAR},
      </if>
      <if test="record.status1 != null" >
        STATUS_1 = #{record.status1,jdbcType=INTEGER},
      </if>
       <if test="record.watchstat != null" >
        watchstat = #{record.watchstat,jdbcType=INTEGER},
      </if>
      <if test="record.wasdeletedfriend != null" >
        wasdeletedfriend = #{record.wasdeletedfriend,jdbcType=INTEGER},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update app_friendship
    set ID = #{record.id,jdbcType=INTEGER},
      UID_0 = #{record.uid0,jdbcType=INTEGER},
      UID_1 = #{record.uid1,jdbcType=INTEGER},
      STATUS = #{record.status,jdbcType=INTEGER},
      CREATE_TIME = #{record.createTime,jdbcType=TIMESTAMP},
      UPDATE_TIME = #{record.updateTime,jdbcType=TIMESTAMP},
      ALIAS_0 = #{record.alias0,jdbcType=VARCHAR},
      ALIAS_1 = #{record.alias1,jdbcType=VARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="com.chinamcom.framework.sociality.model.AppFriendship" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update app_friendship
    <set >
      <if test="uid0 != null" >
        UID_0 = #{uid0,jdbcType=INTEGER},
      </if>
      <if test="uid1 != null" >
        UID_1 = #{uid1,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=INTEGER},
      </if>
      <if test="createTime != null" >
        CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
      </if>
      <if test="alias0 != null" >
        ALIAS_0 = #{alias0,jdbcType=VARCHAR},
      </if>
      <if test="alias1 != null" >
        ALIAS_1 = #{alias1,jdbcType=VARCHAR},
      </if>
    </set>
    where ID = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.chinamcom.framework.sociality.model.AppFriendship" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update app_friendship
    set UID_0 = #{uid0,jdbcType=INTEGER},
      UID_1 = #{uid1,jdbcType=INTEGER},
      STATUS = #{status,jdbcType=INTEGER},
      CREATE_TIME = #{createTime,jdbcType=TIMESTAMP},
      UPDATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
      ALIAS_0 = #{alias0,jdbcType=VARCHAR},
      ALIAS_1 = #{alias1,jdbcType=VARCHAR}
    where ID = #{id,jdbcType=INTEGER}
  </update>
</mapper>